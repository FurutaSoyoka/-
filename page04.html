<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>一文字ずつ、手繰り寄せる</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #333;
            --accent-color: #bbb;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Hiragino Mincho ProN", "serif";
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #app {
            width: 85%;
            max-width: 400px;
            min-height: 12em;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #text-display {
            font-size: 1.25rem;
            line-height: 2.2;
            letter-spacing: 0.15em;
            word-break: break-all;
        }

        /* 出てきた文字のアニメーション */
        .char {
            opacity: 0;
            transform: translateX(-5px);
            display: inline-block;
            animation: charAppear 0.2s forwards ease-out;
        }

        @keyframes charAppear {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* 状況ガイド */
        #status-guide {
            position: fixed;
            bottom: 8%;
            width: 100%;
            text-align: center;
            font-size: 0.7rem;
            color: var(--accent-color);
            letter-spacing: 0.2em;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        button {
            background: none;
            border: 1px solid var(--text-color);
            padding: 15px 30px;
            font-family: inherit;
            letter-spacing: 0.1em;
        }
    </style>
</head>
<body>

    <div id="overlay">
        <button id="start-btn">体験を始める</button>
    </div>

    <div id="app">
        <div id="text-display"></div>
    </div>

    <div id="status-guide">左右に軽く振って読み進める</div>

    <script>
        const sentences = [
            "本作品は、スマートフォンにおける無意識なスクロール行為によって、",
            "文章が読まれなくなっている現状に対し、",
            "「振る」という身体的動作を、読む行為のトリガーとして設計した。",
            "文章はスクロールでは進まず、振ることで一文字ずつ現れる。",
            "一文字ずつ、その手で手繰り寄せるように。",
            "情報を消費するのではなく、「読む体験」へと変換するために。"
        ];

        let currentSentenceIdx = 0;
        let currentCharIdx = 0;
        let isWaitingNextSentence = false;
        let lastShakeTime = 0;
        const shakeCooldown = 150; // 次の文字が出るまでの最短時間(ms)
        const shakeThreshold = 8;  // X軸の加速度の変化量のしきい値（小さいほど敏感）

        const displayEl = document.getElementById('text-display');
        const statusEl = document.getElementById('status-guide');

        // 文字を追加表示する
        function showNextChar() {
            const now = Date.now();
            if (now - lastShakeTime < shakeCooldown) return;

            const currentSentence = sentences[currentSentenceIdx];

            // 新しい文章の開始時
            if (currentCharIdx === 0 && !isWaitingNextSentence) {
                displayEl.innerHTML = '';
            }

            if (currentCharIdx < currentSentence.length) {
                const span = document.createElement('span');
                span.innerText = currentSentence[currentCharIdx];
                span.className = 'char';
                displayEl.appendChild(span);
                
                currentCharIdx++;
                lastShakeTime = now;
                vibrate(15); // 軽い手応え

                // 文章がすべて出揃ったか
                if (currentCharIdx === currentSentence.length) {
                    isWaitingNextSentence = true;
                    statusEl.innerText = "大きく振って次の行へ";
                } else {
                    statusEl.innerText = "振って読み進める";
                }
            } else if (isWaitingNextSentence) {
                // 文章が終わった状態で振られたら次へ
                vibrate(40); // 少し強めの手応え
                currentSentenceIdx++;
                if (currentSentenceIdx >= sentences.length) currentSentenceIdx = 0;
                currentCharIdx = 0;
                isWaitingNextSentence = false;
                displayEl.innerHTML = '';
                statusEl.innerText = "振って読み進める";
            }
        }

        function vibrate(ms) {
            if (navigator.vibrate) navigator.vibrate(ms);
        }

        let lastX = 0;
        function handleMotion(event) {
            const acc = event.acceleration; // 重力を除いた加速度
            if (!acc || acc.x === null) return;

            // X軸（左右）の動きの強さを計算
            const deltaX = Math.abs(acc.x - lastX);
            
            if (deltaX > shakeThreshold) {
                showNextChar();
            }
            lastX = acc.x;
        }

        document.getElementById('start-btn').addEventListener('click', async () => {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                const permission = await DeviceMotionEvent.requestPermission();
                if (permission === 'granted') {
                    window.addEventListener('devicemotion', handleMotion);
                }
            } else {
                window.addEventListener('devicemotion', handleMotion);
            }
            document.getElementById('overlay').style.display = 'none';
        });
    </script>
</body>
</html>
